<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Join libchewing Development</title>

		<meta name="description" content="">
		<meta name="author" content="ChangZhuo Chen (https://github.com/czchen)">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Joining libchewing Development</h1>
					<p>ChangZhuo Chen (<a href="https://github.com/czchen">https://github.com/czchen</a>)</p>
				</section>

				<section>
					<h1>LICENSE</h1>
					<p><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">CC-BY-NC-SA</a></p>
				</section>

				<section>
					<p>One day in <a href="http://www.hackingthursday.org/">Hacking Thursday</a></p>
					<ul>
						<li>czchen: 新酷音這部份的 code 是作啥用的阿</li>
						<li>kanru: ??? </li>
						<li>czchen: ...</li>
					</ul>
					<aside class="notes">
						被推坑了
					</aside>
				</section>

				<section>
					<p>coding → building → testing → coding → ...</p>
				</section>

				<section>
					<h2>Send pull request</h2>
					<img src="data/pull_14.png" alt="pull request 14">
				</section>

				<section>
					<p>感覺 Unit Test 有點少，會不會改出問題阿？</p>
				</section>

				<section>
					<a href="https://github.com/chewing/libchewing/issues/26">https://github.com/chewing/libchewing/issues/26</a>
					<img src="data/issue_26.png">
				</section>

				<section>
					<p>coding → building → testing → coding → ...</p>
				</section>

				<section>
					<h2>Fixed</h2>
					<img src="data/issue_26_fix.png">
				</section>

				<section>
					<p>為了避免再次發生問題，來研究一下 Unit Test 吧</p>
				</section>

				<section>
					<p>先加個 coverage report</p>
					<pre><code data-trim contenteditable>
dnl Enable gcov for coverage test
AC_ARG_ENABLE(
	[gcov],
	AS_HELP_STRING(
		[--enable-gcov],
		[Turn on gcov support @&lt;:@default=no@:&gt;@]),
	AS_CASE(
		[${enableval}],
		[yes], [ENABLE_GCOV="true"],
		[ENABLE_GCOV="false"]),
	[ENABLE_GCOV="false"])
AS_IF([test x$ENABLE_GCOV = x"true"],
	[AM_CFLAGS="$AM_CFLAGS --coverage"])
					</code></pre>
					<aside class="notes">
						http://gcc.gnu.org/onlinedocs/gcc/Gcov.html
					</aside>
				</section>

				<section>
					<p><a href="http://kanru.info/chewing/lcov-check/">http://kanru.info/chewing/lcov-check/</a></p>
					<img src="data/initial_coverage.png">
				</section>

				<section>
					<p>看起來有點弱阿，應該要強化一下</p>
					<p>那就先寫一些 Unit Test 順便熟悉一下 libchewing 的 API 吧</p>
				</section>

				<section>
					<p>先隨邊抓幾個 API 來看看</p>
					<pre><code data-trim contenteditable>
CHEWING_API void chewing_set_candPerPage(ChewingContext *ctx, int n)
{
	ctx->data->config.candPerPage = n;
}

CHEWING_API int chewing_get_candPerPage(ChewingContext *ctx)
{
	return ctx->data->config.candPerPage;
}
					</code></pre>
				</section>

				<section>
					<p>candidate per page 沒有參數檢查？這樣會出事吧</p>
				</section>

				<section>
					<p>其實預設 candidate per page 是 0 → 預設 divide by zero</p>
				</section>

				<section>
					<p>修改預設值通常會造成一些問題，要小心修改，不過 ...</p>
					<p></p>
					<ul>
						<li>candidate per page (0 → 10)</li>
						<li>preedit buffer (0 → 39)</li>
						<li>default select key (\0 * 10 → 1234567890)</li>
					</ul>
				</section>

				<section>
					<p>順便把改過的 API 都加上 Unit Test</p>
					<pre><code data-trim contenteditable>
for (i = 0; i &lt; ARRAY_SIZE(VALUE); ++i) {
	chewing_set_candPerPage(ctx, VALUE[i]);
	ok(chewing_get_candPerPage(ctx) == VALUE[i],
		"candPerPage shall be `%d'", VALUE[i]);

	// mode shall not change when set mode has invalid value.
	for (j = 0; j &lt; ARRAY_SIZE(INVALID_VALUE); ++j) {
		chewing_set_candPerPage(ctx, INVALID_VALUE[j]);
		ok(chewing_get_candPerPage(ctx) == VALUE[i],
			"candPerPage shall be `%d'", VALUE[i]);
	}
}
					</code></pre>
				</section>

				<section>
					<p>再加上前輩提供的 stress test script 找出 crash 的部分</p>
					<pre><code data-trim contenteditable>
commit 496cd753b7e6ce1e5c21fa574ce3e8d9cc07ed58
Author: Kuang-che Wu &lt;kcwu@csie.org&gt;
Date:   Fri Jan 18 17:23:33 2013 +0800

	Add script to run stress test

test/stresstest.py
					</code></pre>
					<p></p>
				</section>

				<section>
					<p><a href="https://drone.io/github.com/chewing/libchewing/files">https://drone.io/github.com/chewing/libchewing/files</a></p>
					<img src="data/coverage.png">
				</section>

				<section>
					<p>接下來來試試在 Windows 上 build</p>
				</section>

				<section>
					<p><a href="http://sourceforge.net/projects/mingw/files/Installer/mingw-get-inst/">MinGW - Minimalist GNU for Windows</a></p>
					<p>用起來很簡單，只要 s/apt/mingw/</p>
					<pre><code data-trim contenteditable>
mingw-get install automake
mingw-get install autoconf
mingw-get install libtool
./autogen.sh
./configure
make
					</code></pre>
				</section>

				<section>
					<p>有些小問題需要注意一下</p>
					<p>CR/LF → CR</p>
					<pre><code data-trim contenteditable>
git config core.autocrlf input
rm -rf *
git reset --hard
					</code></pre>
					<p>Windows 顯示亂碼</p>
					<pre><code data-trim contenteditable>
chcp 65001
					</code></pre>
				</section>

				<section>
					<p>在 Windows 上，應該要試試看 Visual Studio，不過又不想把 Visual Studio 的 project files 放到 git 上</p>
				</section>

				<section>
					<p>那試試看用 CMake 好了</p>
				</section>

				<section>
					<p>不過我不會 CMake，先抓個 <a href="http://www.cmake.org/cmake/help/cmake_tutorial.html">tutorial</a> 來看看吧</p>
				</section>

				<section>
					<p>看起來只要把 build process 依照 CMake 的方式寫出來就好</p>
				</section>

				<section>
					<p>以下是 libchewing build process</p>
					<img src="data/build.png">
				</section>

				<section>
					<p>依照 <a href="http://www.cmake.org/cmake/help/documentation.html">CMake manual</a> 上的說明把對應的 command 找出來</p>
				</section>

				<section>
					<p>會遇到一些問題，不過大致上是可以 build 的</p>
					<p><a href="https://github.com/chewing/libchewing/issues/40">[Issue 40] cmake cannot build gen_keystroke</a></p>
					<p></p>
				</section>

				<section>
					<p>那試試看在 Windows 上用 Visual Studio Express 2012</p>
				</section>

				<section>
					<p>build fail</p>
					<p>要把 source 中 Visual Studio 不 support 的部份改掉</p>
				</section>

				<section>
					<p>修改 tools 的 output directory</p>
					<pre><code data-trim contenteditable>
add_executable(sort ${TOOLS_SRC_DIR}/sort.c $&lt;TARGET_OBJECTS:common&gt;)
add_executable(maketree ${TOOLS_SRC_DIR}/maketree.c)
set_target_properties(${ALL_TOOLS} PROPERTIES
		RUNTIME_OUTPUT_DIRECTORY ${TOOLS_BIN_DIR}
		RUNTIME_OUTPUT_DIRECTORY_DEBUG ${TOOLS_BIN_DIR}
		RUNTIME_OUTPUT_DIRECTORY_MINSIZEREL ${TOOLS_BIN_DIR}
		RUNTIME_OUTPUT_DIRECTORY_RELEASE ${TOOLS_BIN_DIR}
		RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO ${TOOLS_BIN_DIR}
)
					</code></pre>
				</section>

				<section>
					<p>把 UTF-8 string 改成 \xAA 的形式</p>
					<p><a href="http://www.nubaria.com/en/blog/?p=289">Using UTF-8 as the internal representation for strings in C and C++ with Visual Studio</a></p>
				</section>

				<section>
					<p>拿掉 designated initializer</p>
					<p><a href="http://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/363d81f6-2308-492d-b530-2614b333e9e0/#aeece11a-ce75-434a-b140-cb54356d904e">C99 Designated Initializers support</a></p>
					<img src="data/visual_studio_designated_initializer.png">
				</section>

				<section>
					<p>然後就可以用了</p>
					<pre><code data-trim contenteditable>
cmake PATH -G "Visual Studio 11 Win64"
					</code></pre>
					<img src="data/Visual_Studio_Solution.png">
				</section>

				<section>
					<p>Unit Test 也可以用</p>
					<img src="data/Visual_Studio_Testing.png">
				</section>

				<section>
					<h2>travis-ci</h2>
					<a href="https://travis-ci.org/chewing/libchewing">https://travis-ci.org/chewing/libchewing</a>
				</section>

				<section>
					<p>只要把 .travis.yml 加 到 project 內就可以用了</p>
				</section>

				<section>
					<p>travis-ci 會 build 下列幾種組合</p>
					<ul>
						<li>gcc + autotools</li>
						<li>clang + autotools + disable-binary-data</li>
						<li>gcc + cmake + valgrind</li>
						<li>clang + cmake + address sanitizer</li>
					</ul>
				</section>

				<section>
					<h2>drone.io</h2>
					<a href="https://drone.io/github.com/chewing/libchewing">https://drone.io/github.com/chewing/libchewing</a>
				</section>

				<section>
					<p>設定 Commands</p>
					<pre><code data-trim contenteditable>
sudo apt-get install -qq lcov texinfo
./autogen.sh
./configure --enable-gcov
make dist
make check
scripts/lcov.sh
tar czf coveragereport.tar.gz coveragereport
					</code></pre>
					<p>設定 Artifacts</p>
					<pre><code data-trim contenteditable>
coveragereport.tar.gz
libchewing-*.tar.gz
					</code></pre>
				</section>

				<section>
					<p>就可以產生 package 和 coverage report</p>
					<a href="https://drone.io/github.com/chewing/libchewing/files">https://drone.io/github.com/chewing/libchewing/files</a>
					<img src="data/drone.io.download.png">
				</section>

				<section>
					<h2>Launchpad</h2>
					<p><a href="https://launchpad.net/~chewing/+archive/chewing">https://launchpad.net/~chewing/+archive/chewing</a></p>
					<img src="data/launchpad.net.png">
				</section>

				<section>
					<h2>Stress Test Script</h2>
					<pre><code data-trim contenteditable>
commit 496cd753b7e6ce1e5c21fa574ce3e8d9cc07ed58
Author: Kuang-che Wu &lt;kcwu@csie.org&gt;
Date:   Fri Jan 18 17:23:33 2013 +0800

	Add script to run stress test

test/stresstest.py
					</code></pre>
				</section>

				<section>
					<h1>We are hiring</h1>
					<p>Send a pull request to <a href="https://github.com/chewing/libchewing](https://github.com/chewing/libchewing">https://github.com/chewing/libchewing</a>
					<img src="data/we_are_hiring.png">
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
